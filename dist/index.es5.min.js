/*!
 * ~
 *  maishu-chitu-service v1.45.0
 *  
 *  Copyright (c) 2016-2018, shu mai <ansiboy@163.com>
 *  Licensed under the MIT License.
 * 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["chitu-service"]=t():e["chitu-service"]=t()}("undefined"==typeof window?global:window,function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.Callbacks=t.Callback=void 0;var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.funcs=new Array}var t,r,o;return t=e,(r=[{key:"add",value:function(e){this.funcs.push(e)}},{key:"remove",value:function(e){this.funcs=this.funcs.filter(function(t){return t!=e})}},{key:"fire",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this.funcs.forEach(function(e){return e.apply(void 0,t)})}},{key:"clear",value:function(){for(;this.funcs.length>0;)this.funcs.pop()}}])&&n(t.prototype,r),o&&n(t,o),e}();t.Callback=o,t.Callbacks=function(){return new o}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StatusCode=t.StatusCodes=t.CookieValueStore=t.LocalValueStore=t.ValueStore=t.Callbacks=t.Callback=t.formatData=t.Service=void 0;var n=r(2);Object.defineProperty(t,"Service",{enumerable:!0,get:function(){return n.Service}}),Object.defineProperty(t,"formatData",{enumerable:!0,get:function(){return n.formatData}});var o=r(0);Object.defineProperty(t,"Callback",{enumerable:!0,get:function(){return o.Callback}}),Object.defineProperty(t,"Callbacks",{enumerable:!0,get:function(){return o.Callbacks}});var a=r(4);Object.defineProperty(t,"ValueStore",{enumerable:!0,get:function(){return a.ValueStore}}),Object.defineProperty(t,"LocalValueStore",{enumerable:!0,get:function(){return a.LocalValueStore}}),Object.defineProperty(t,"CookieValueStore",{enumerable:!0,get:function(){return a.CookieValueStore}});var u=r(5);Object.defineProperty(t,"StatusCodes",{enumerable:!0,get:function(){return u.StatusCode}}),Object.defineProperty(t,"StatusCode",{enumerable:!0,get:function(){return u.StatusCode}})},function(module,exports,__webpack_require__){"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}var __awaiter=function(e,t,r,n){return new(r||(r=Promise))(function(o,a){function u(e){try{c(n.next(e))}catch(e){a(e)}}function i(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(u,i)}c((n=n.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.formatData=exports.Service=void 0;var callback_js_1=__webpack_require__(0),errors_js_1=__webpack_require__(3),methods={get:"get",put:"put",post:"post",delete:"delete"},Service=function(){function Service(e){var t=this;_classCallCheck(this,Service),this.error=(0,callback_js_1.Callbacks)(),this.headers={},e&&this.error.add(function(r,n){e(n,t)})}return _createClass(Service,[{key:"loadNodeFetchModule",value:function loadNodeFetchModule(){return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function _callee(){var nodeFetch;return regeneratorRuntime.wrap(function _callee$(_context){for(;;)switch(_context.prev=_context.next){case 0:return _context.next=2,eval("import('node-fetch')");case 2:return nodeFetch=_context.sent.default,_context.abrupt("return",nodeFetch);case 4:case"end":return _context.stop()}},_callee)}))}},{key:"ajax",value:function ajax(url,options){var _this2=this;void 0===options&&(options={});var data=options.data,method=options.method||methods.get,headers=Object.assign({},Service.headers,this.headers,options.headers||{}),body;if(null!=data){var is_json=(headers["content-type"]||"").indexOf("json")>=0,is_formdata=(headers["content-type"]||"").indexOf("form-data")>=0;if(is_json)body=JSON.stringify(data);else if(is_formdata){if(delete headers["content-type"],"undefined"==typeof FormData){var _FormData=eval("require")("form-data");body=new _FormData}else body=new FormData;for(var key in data)body.append(key,data[key])}else for(var _key in body=new URLSearchParams,data)body.append(_key,data[_key])}return new Promise(function(e,t){var r,n=method==methods.get?{headers:headers,method:method}:{headers:headers,body:body,method:method};if(null==n)throw errors_js_1.errors.unexpectedNullValue("options");method==methods.get&&(r=setTimeout(function(){console.warn("timeout url: ".concat(url));var e=new Error;e.name="timeout",e.message="Connect timeout, url: ".concat(url),t(e),_this2.error.fire(_this2,e),clearTimeout(r)},1e3*Service.settings.ajaxTimeout)),_this2._ajax(url,n,function(){return _this2.loadNodeFetchModule()}).then(function(t){e(t),r&&clearTimeout(r)}).catch(function(o){"object"==_typeof(o)&&(o.detail="Execute url '".concat(url,"' by method ").concat(n.method," fail.")),_this2.error.fire(_this2,o),void 0!==o.processed?e(o.processed):t(o),r&&clearTimeout(r)})})}},{key:"_ajax",value:function(e,t,r){return __awaiter(this,void 0,void 0,regeneratorRuntime.mark(function n(){var o,a,u,i=this;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if("undefined"!=typeof window){n.next=7;break}return n.next=3,r();case 3:u=n.sent,a=u(e,t),n.next=8;break;case 7:a=fetch(e,t);case 8:return n.abrupt("return",new Promise(function(e,r){a.then(function(e){var t=(o=e).text();return"string"==typeof t?new Promise(function(e,r){e(t)}):t}).then(function(n){var a;if((o.headers.get("content-type")||"").indexOf("json")>=0)try{a=n?JSON.parse(n):{}}catch(e){var u=errors_js_1.errors.parseJSONFail(n);console.error(u),a=n}else a=n;if(o.status>=300){var c=new Error;return c.method=t.method,c.name="".concat(o.status),c.message="string"==typeof a?a:a.Message||a.message||"",c.message=c.message||o.statusText,void r(c)}a=i.formatData(a),e(a)}).catch(function(e){console.error(e),r(e)})}));case 9:case"end":return n.stop()}},n)}))}},{key:"formatData",value:function(e){return _formatData(e)}},{key:"createService",value:function(e){var t=this,r=new(e=e||Service);return r.error.add(function(e,n){t.error.fire(r,n)}),r}},{key:"getByJson",value:function(e,t,r){return t&&Object.getOwnPropertyNames(t).length>0&&(e="".concat(e,"?").concat(encodeURIComponent(JSON.stringify(t)))),(r=r||{})["content-type"]="application/json",this.ajax(e,{headers:r,method:methods.get})}},{key:"putByJson",value:function(e,t,r){return(r=r||{})["content-type"]="application/json",this.ajax(e,{headers:r,data:t,method:methods.put})}},{key:"postByJson",value:function(e,t,r){return(r=r||{})["content-type"]="application/json",this.ajax(e,{headers:r,data:t,method:methods.post})}},{key:"deleteByJson",value:function(e,t,r){return(r=r||{})["content-type"]="application/json",this.ajax(e,{headers:r,data:t,method:methods.delete})}},{key:"putByFormData",value:function(e,t,r){return(r=r||{})["content-type"]="multipart/form-data",this.ajax(e,{headers:r,data:t,method:methods.put})}},{key:"postByFormData",value:function(e,t,r){return(r=r||{})["content-type"]="multipart/form-data",this.ajax(e,{headers:r,data:t,method:methods.post})}},{key:"deleteByFormData",value:function(e,t,r){return(r=r||{})["content-type"]="multipart/form-data",this.ajax(e,{headers:r,data:t,method:methods.delete})}},{key:"isEncoded",value:function(e){try{return(e=e||"")!==decodeURIComponent(e)}catch(e){return!1}}},{key:"get",value:function(e,t,r){t=t||{};var n="";for(var o in t)if(null!=t[o]){var a="".concat(t[o]);this.isEncoded(a)||(a=encodeURIComponent(a)),n=n?"".concat(n,"&").concat(o,"=").concat(a):"".concat(o,"=").concat(a)}return n&&(e="".concat(e,"?").concat(n)),this.ajax(e,{headers:r,method:methods.get})}},{key:"put",value:function(e,t,r){return(r=r||{})["content-type"]="application/x-www-form-urlencoded",this.ajax(e,{headers:r,data:t,method:methods.put})}},{key:"post",value:function(e,t,r){return(r=r||{})["content-type"]="application/x-www-form-urlencoded",this.ajax(e,{headers:r,data:t,method:methods.post})}},{key:"delete",value:function(e,t,r){return(r=r||{})["content-type"]="application/x-www-form-urlencoded",this.ajax(e,{headers:r,data:t,method:methods.delete})}}]),Service}();function _formatData(e){if("object"==_typeof(e)){for(var t in e)e[t]=_formatData(e[t]);return e}return"string"==typeof e&&/^\d{4}-\d{1,2}-\d{1,2}T\d{1,2}:\d{1,2}:\d{1,2}$/.test(e)?new Date(e):e}exports.Service=Service,Service.settings={ajaxTimeout:30},Service.headers={},exports.formatData=_formatData},function(e,t,r){"use strict";function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.errors=t.Errors=void 0;var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r,o;return t=e,(r=[{key:"unexpectedNullValue",value:function(e){var t="variable ".concat(e," is unexpected null value.");return new Error(t)}},{key:"parseJSONFail",value:function(e){var t="Parse json string fail:\r\n".concat(e);return new Error(t)}}])&&n(t.prototype,r),o&&n(t,o),e}();t.Errors=o,t.errors=new o},function(e,t,r){"use strict";function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){return!t||"object"!==n(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(e,t,r,n){return(a="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,r,n){var o,a=c(e,t);if(a){if((o=Object.getOwnPropertyDescriptor(a,t)).set)return o.set.call(n,r),!0;if(!o.writable)return!1}if(o=Object.getOwnPropertyDescriptor(n,t)){if(!o.writable)return!1;o.value=r,Object.defineProperty(n,t,o)}else!function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(n,t,r);return!0})(e,t,r,n)}function u(e,t,r,n,o){if(!a(e,t,r,n||e)&&o)throw new Error("failed to set property");return r}function i(e,t,r){return(i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,r){var n=c(e,t);if(n){var o=Object.getOwnPropertyDescriptor(n,t);return o.get?o.get.call(r):o.value}})(e,t,r||e)}function c(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function y(e,t,r){return t&&p(e.prototype,t),r&&p(e,r),e}Object.defineProperty(t,"__esModule",{value:!0}),t.CookieValueStore=t.LocalValueStore=t.ValueStore=void 0;var h=function(){function e(t){d(this,e),this.items=new Array,this._value=t}return y(e,[{key:"attach",value:function(e,t){return void 0!==this.value&&e(this.value,t),this.add(e,t)}},{key:"add",value:function(e,t){return this.items.push({func:e,sender:t}),e}},{key:"remove",value:function(e){this.items=this.items.filter(function(t){return t.func!=e})}},{key:"fire",value:function(e){this.items.forEach(function(t){return t.func(e,t.sender)})}},{key:"value",get:function(){return void 0===this._value?null:this._value},set:function(e){this._value=e||void 0,this.fire(e)}}]),e}();t.ValueStore=h;var v=function(e){function t(e){var r;return d(this,t),(r=o(this,s(t).call(this,t.loadValue(e)))).storageName=e,r}return l(t,h),y(t,[{key:"value",get:function(){return i(s(t.prototype),"value",this)},set:function(e){u(s(t.prototype),"value",e,this,!0),t.saveValue(this.storageName,e)}}],[{key:"loadValue",value:function(e){var t=localStorage.getItem(e);if(null!=t)return JSON.parse(t)}},{key:"saveValue",value:function(e,t){null!=t?localStorage.setItem(e,JSON.stringify(t)):localStorage.removeItem(e)}}]),t}();t.LocalValueStore=v;var m=function(e){function t(e){var r;return d(this,t),(r=o(this,s(t).call(this,t.loadValue(e)))).storageName=e,r}return l(t,h),y(t,[{key:"value",get:function(){return i(s(t.prototype),"value",this)},set:function(e){u(s(t.prototype),"value",e,this,!0),t.saveValue(this.storageName,e)}}],[{key:"loadValue",value:function(e){var r=t.getCookie(e);if(null!=r)return JSON.parse(r)}},{key:"saveValue",value:function(e,r){null!=r?t.setCookie(e,JSON.stringify(r)):t.removeCookie(e)}},{key:"setCookie",value:function(e,t,r){if("undefined"!=typeof document){var n="";if(r){var o=new Date;o.setTime(o.getTime()+24*r*60*60*1e3),n="; expires="+o.toUTCString()}document.cookie=e+"="+(t||"")+n+"; path=/"}}},{key:"getCookie",value:function(e){if("undefined"==typeof document)return null;for(var t=e+"=",r=document.cookie.split(";"),n=0;n<r.length;n++){for(var o=r[n];" "==o.charAt(0);)o=o.substring(1,o.length);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return null}},{key:"removeCookie",value:function(e){this.setCookie(e,"")}}]),t}();t.CookieValueStore=m},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StatusCode=void 0,function(e){e[e.Login=282]="Login",e[e.Logout=283]="Logout",e[e.NotFound=404]="NotFound",e[e.OK=200]="OK",e[e.Redirect=301]="Redirect",e[e.BadRequest=400]="BadRequest",e[e.Forbidden=403]="Forbidden",e[e.CustomError=700]="CustomError",e[e.ArgumentNull=705]="ArgumentNull",e[e.FieldNull=709]="FieldNull",e[e.ArgumentTypeIncorrect=710]="ArgumentTypeIncorrect",e[e.UserNotLogin=718]="UserNotLogin",e[e.NoPermission=726]="NoPermission",e[e.UserIdNull=727]="UserIdNull",e[e.ObjectNotExistWithId=728]="ObjectNotExistWithId"}(t.StatusCode||(t.StatusCode={}))}])});
//# sourceMappingURL=index.es5.min.js.map