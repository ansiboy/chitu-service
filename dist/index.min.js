/*!
 * ~
 *  maishu-chitu-service v1.41.0
 *  
 *  Copyright (c) 2016-2018, shu mai <ansiboy@163.com>
 *  Licensed under the MIT License.
 * 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["chitu-service"]=t():e["chitu-service"]=t()}("undefined"==typeof window?global:window,function(){return function(e){var t={};function r(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(o,n,function(t){return e[t]}.bind(null,n));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Callbacks=t.Callback=void 0;class o{constructor(){this.funcs=new Array}add(e){this.funcs.push(e)}remove(e){this.funcs=this.funcs.filter(t=>t!=e)}fire(...e){this.funcs.forEach(t=>t(...e))}clear(){for(;this.funcs.length>0;)this.funcs.pop()}}t.Callback=o,t.Callbacks=function(){return new o}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StatusCode=t.StatusCodes=t.CookieValueStore=t.LocalValueStore=t.ValueStore=t.Callbacks=t.Callback=t.formatData=t.Service=void 0;var o=r(2);Object.defineProperty(t,"Service",{enumerable:!0,get:function(){return o.Service}}),Object.defineProperty(t,"formatData",{enumerable:!0,get:function(){return o.formatData}});var n=r(0);Object.defineProperty(t,"Callback",{enumerable:!0,get:function(){return n.Callback}}),Object.defineProperty(t,"Callbacks",{enumerable:!0,get:function(){return n.Callbacks}});var a=r(4);Object.defineProperty(t,"ValueStore",{enumerable:!0,get:function(){return a.ValueStore}}),Object.defineProperty(t,"LocalValueStore",{enumerable:!0,get:function(){return a.LocalValueStore}}),Object.defineProperty(t,"CookieValueStore",{enumerable:!0,get:function(){return a.CookieValueStore}});var s=r(5);Object.defineProperty(t,"StatusCodes",{enumerable:!0,get:function(){return s.StatusCode}}),Object.defineProperty(t,"StatusCode",{enumerable:!0,get:function(){return s.StatusCode}})},function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))(function(n,a){function s(e){try{u(o.next(e))}catch(e){a(e)}}function i(e){try{u(o.throw(e))}catch(e){a(e)}}function u(e){var t;e.done?n(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,i)}u((o=o.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.formatData=exports.Service=void 0;const callback_1=__webpack_require__(0),errors_1=__webpack_require__(3);let methods={get:"get",put:"put",post:"post",delete:"delete"};class Service{constructor(e){this.error=callback_1.Callbacks(),this.headers={},e&&this.error.add((t,r)=>{e(r,this)})}ajax(e,t){void 0===t&&(t={});let r,o=t.data,n=t.method||methods.get,a=Object.assign({},Service.headers,this.headers,t.headers||{});if(null!=o){let e=(a["content-type"]||"").indexOf("json")>=0,t=(a["content-type"]||"").indexOf("form-data")>=0;if(e)r=JSON.stringify(o);else if(t){delete a["content-type"],r=new FormData;for(let e in o)r.append(e,o[e])}else{r=new URLSearchParams;for(let e in o)r.append(e,o[e])}}return new Promise((t,o)=>{let s,i=n==methods.get?{headers:a,method:n}:{headers:a,body:r,method:n};if(null==i)throw errors_1.errors.unexpectedNullValue("options");n==methods.get&&(s=setTimeout(()=>{console.warn(`timeout url: ${e}`);let t=new Error;t.name="timeout",t.message=`Connect timeout, url: ${e}`,o(t),this.error.fire(this,t),clearTimeout(s)},1e3*Service.settings.ajaxTimeout)),ajax(e,i).then(e=>{t(e),s&&clearTimeout(s)}).catch(r=>{"object"==typeof r&&(r.detail=`Execute url '${e}' by method ${i.method} fail.`),this.error.fire(this,r),void 0!==r.processed?t(r.processed):o(r),s&&clearTimeout(s)})})}createService(e){let t=new(e=e||Service);return t.error.add((e,r)=>{this.error.fire(t,r)}),t}getByJson(e,t,r){return t&&Object.getOwnPropertyNames(t).length>0&&(e=`${e}?${encodeURIComponent(JSON.stringify(t))}`),(r=r||{})["content-type"]="application/json",this.ajax(e,{headers:r,method:methods.get})}putByJson(e,t,r){return(r=r||{})["content-type"]="application/json",this.ajax(e,{headers:r,data:t,method:methods.put})}postByJson(e,t,r){return(r=r||{})["content-type"]="application/json",this.ajax(e,{headers:r,data:t,method:methods.post})}deleteByJson(e,t,r){return(r=r||{})["content-type"]="application/json",this.ajax(e,{headers:r,data:t,method:methods.delete})}putByFormData(e,t,r){return(r=r||{})["content-type"]="multipart/form-data",this.ajax(e,{headers:r,data:t,method:methods.put})}postByFormData(e,t,r){return(r=r||{})["content-type"]="multipart/form-data",this.ajax(e,{headers:r,data:t,method:methods.post})}deleteByFormData(e,t,r){return(r=r||{})["content-type"]="multipart/form-data",this.ajax(e,{headers:r,data:t,method:methods.delete})}isEncoded(e){try{return(e=e||"")!==decodeURIComponent(e)}catch(e){return!1}}get(e,t,r){t=t||{};let o="";for(let e in t){if(null==t[e])continue;let r=`${t[e]}`;this.isEncoded(r)||(r=encodeURIComponent(r)),o=o?`${o}&${e}=${r}`:`${e}=${r}`}return o&&(e=`${e}?${o}`),this.ajax(e,{headers:r,method:methods.get})}put(e,t,r){return(r=r||{})["content-type"]="application/x-www-form-urlencoded",this.ajax(e,{headers:r,data:t,method:methods.put})}post(e,t,r){return(r=r||{})["content-type"]="application/x-www-form-urlencoded",this.ajax(e,{headers:r,data:t,method:methods.post})}delete(e,t,r){return(r=r||{})["content-type"]="application/x-www-form-urlencoded",this.ajax(e,{headers:r,data:t,method:methods.delete})}}function formatData(e){if("object"==typeof e){for(let t in e)e[t]=formatData(e[t]);return e}return"string"==typeof e&&/^\d{4}-\d{1,2}-\d{1,2}T\d{1,2}:\d{1,2}:\d{1,2}/.test(e)?new Date(e):e}function ajax(url,options){return __awaiter(this,void 0,void 0,function*(){let response,responsePromise;if("undefined"==typeof window){let nodeFetch=eval("require")("node-fetch");responsePromise=nodeFetch(url,options)}else responsePromise=fetch(url,options);return new Promise((e,t)=>{responsePromise.then(e=>{let t,r=(response=e).text();return t="string"==typeof r?new Promise((e,t)=>{e(r)}):r}).then(r=>{let o;if((response.headers.get("content-type")||"").indexOf("json")>=0)try{o=r?JSON.parse(r):{}}catch(e){let t=errors_1.errors.parseJSONFail(r);console.error(t),o=r}else o=r;if(response.status>=300){let e=new Error;return e.method=options.method,e.name=`${response.status}`,e.message="string"==typeof o?o:o.Message||o.message||"",e.message=e.message||response.statusText,void t(e)}o=formatData(o),e(o)}).catch(e=>{console.error(e),t(e)})})})}exports.Service=Service,Service.settings={ajaxTimeout:30},Service.headers={},exports.formatData=formatData},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errors=t.Errors=void 0;class o{unexpectedNullValue(e){return new Error(`variable ${e} is unexpected null value.`)}parseJSONFail(e){return new Error(`Parse json string fail:\r\n${e}`)}}t.Errors=o,t.errors=new o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CookieValueStore=t.LocalValueStore=t.ValueStore=void 0;class o{constructor(e){this.items=new Array,this._value=e}attach(e,t){return void 0!==this.value&&e(this.value,t),this.add(e,t)}add(e,t){return this.items.push({func:e,sender:t}),e}remove(e){this.items=this.items.filter(t=>t.func!=e)}fire(e){this.items.forEach(t=>t.func(e,t.sender))}get value(){return void 0===this._value?null:this._value}set value(e){this._value=e||void 0,this.fire(e)}}t.ValueStore=o;class n extends o{constructor(e){super(n.loadValue(e)),this.storageName=e}get value(){return super.value}set value(e){super.value=e,n.saveValue(this.storageName,e)}static loadValue(e){let t=localStorage.getItem(e);if(null!=t)return JSON.parse(t)}static saveValue(e,t){null!=t?localStorage.setItem(e,JSON.stringify(t)):localStorage.removeItem(e)}}t.LocalValueStore=n;class a extends o{constructor(e){super(a.loadValue(e)),this.storageName=e}get value(){return super.value}set value(e){super.value=e,a.saveValue(this.storageName,e)}static loadValue(e){let t=a.getCookie(e);if(null!=t)return JSON.parse(t)}static saveValue(e,t){null!=t?a.setCookie(e,JSON.stringify(t)):a.removeCookie(e)}static setCookie(e,t,r){if("undefined"!=typeof document){var o="";if(r){var n=new Date;n.setTime(n.getTime()+24*r*60*60*1e3),o="; expires="+n.toUTCString()}document.cookie=e+"="+(t||"")+o+"; path=/"}}static getCookie(e){if("undefined"==typeof document)return null;for(var t=e+"=",r=document.cookie.split(";"),o=0;o<r.length;o++){for(var n=r[o];" "==n.charAt(0);)n=n.substring(1,n.length);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return null}static removeCookie(e){this.setCookie(e,"")}}t.CookieValueStore=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StatusCode=void 0,function(e){e[e.Login=282]="Login",e[e.Logout=283]="Logout",e[e.NotFound=404]="NotFound",e[e.OK=200]="OK",e[e.Redirect=301]="Redirect",e[e.BadRequest=400]="BadRequest",e[e.Forbidden=403]="Forbidden",e[e.CustomError=700]="CustomError",e[e.ArgumentNull=705]="ArgumentNull",e[e.FieldNull=709]="FieldNull",e[e.ArgumentTypeIncorrect=710]="ArgumentTypeIncorrect",e[e.UserNotLogin=718]="UserNotLogin",e[e.NoPermission=726]="NoPermission",e[e.UserIdNull=727]="UserIdNull",e[e.ObjectNotExistWithId=728]="ObjectNotExistWithId"}(t.StatusCode||(t.StatusCode={}))}])});
//# sourceMappingURL=index.min.js.map