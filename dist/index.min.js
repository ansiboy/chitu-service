/*!
 * ~
 *  maishu-chitu-service v1.45.0
 *  
 *  Copyright (c) 2016-2018, shu mai <ansiboy@163.com>
 *  Licensed under the MIT License.
 * 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["chitu-service"]=t():e["chitu-service"]=t()}("undefined"==typeof window?global:window,function(){return function(e){var t={};function r(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(o,a,function(t){return e[t]}.bind(null,a));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Callbacks=t.Callback=void 0;class o{constructor(){this.funcs=new Array}add(e){this.funcs.push(e)}remove(e){this.funcs=this.funcs.filter(t=>t!=e)}fire(...e){this.funcs.forEach(t=>t(...e))}clear(){for(;this.funcs.length>0;)this.funcs.pop()}}t.Callback=o,t.Callbacks=function(){return new o}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StatusCode=t.StatusCodes=t.CookieValueStore=t.LocalValueStore=t.ValueStore=t.Callbacks=t.Callback=t.formatData=t.Service=void 0;var o=r(2);Object.defineProperty(t,"Service",{enumerable:!0,get:function(){return o.Service}}),Object.defineProperty(t,"formatData",{enumerable:!0,get:function(){return o.formatData}});var a=r(0);Object.defineProperty(t,"Callback",{enumerable:!0,get:function(){return a.Callback}}),Object.defineProperty(t,"Callbacks",{enumerable:!0,get:function(){return a.Callbacks}});var n=r(4);Object.defineProperty(t,"ValueStore",{enumerable:!0,get:function(){return n.ValueStore}}),Object.defineProperty(t,"LocalValueStore",{enumerable:!0,get:function(){return n.LocalValueStore}}),Object.defineProperty(t,"CookieValueStore",{enumerable:!0,get:function(){return n.CookieValueStore}});var s=r(5);Object.defineProperty(t,"StatusCodes",{enumerable:!0,get:function(){return s.StatusCode}}),Object.defineProperty(t,"StatusCode",{enumerable:!0,get:function(){return s.StatusCode}})},function(module,exports,__webpack_require__){"use strict";var __awaiter=this&&this.__awaiter||function(e,t,r,o){return new(r||(r=Promise))(function(a,n){function s(e){try{u(o.next(e))}catch(e){n(e)}}function i(e){try{u(o.throw(e))}catch(e){n(e)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(s,i)}u((o=o.apply(e,t||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0}),exports.formatData=exports.Service=void 0;const callback_js_1=__webpack_require__(0),errors_js_1=__webpack_require__(3);let methods={get:"get",put:"put",post:"post",delete:"delete"};class Service{constructor(e){this.error=(0,callback_js_1.Callbacks)(),this.headers={},e&&this.error.add((t,r)=>{e(r,this)})}loadNodeFetchModule(){return __awaiter(this,void 0,void 0,function*(){let nodeFetch=(yield eval("import('node-fetch')")).default;return nodeFetch})}ajax(url,options){void 0===options&&(options={});let data=options.data,method=options.method||methods.get,headers=Object.assign({},Service.headers,this.headers,options.headers||{}),body;if(null!=data){let is_json=(headers["content-type"]||"").indexOf("json")>=0,is_formdata=(headers["content-type"]||"").indexOf("form-data")>=0;if(is_json)body=JSON.stringify(data);else if(is_formdata){if(delete headers["content-type"],"undefined"==typeof FormData){let FormData=eval("require")("form-data");body=new FormData}else body=new FormData;for(let e in data)body.append(e,data[e])}else{body=new URLSearchParams;for(let e in data)body.append(e,data[e])}}return new Promise((e,t)=>{let r,o=method==methods.get?{headers:headers,method:method}:{headers:headers,body:body,method:method};if(null==o)throw errors_js_1.errors.unexpectedNullValue("options");method==methods.get&&(r=setTimeout(()=>{console.warn(`timeout url: ${url}`);let e=new Error;e.name="timeout",e.message=`Connect timeout, url: ${url}`,t(e),this.error.fire(this,e),clearTimeout(r)},1e3*Service.settings.ajaxTimeout)),this._ajax(url,o,()=>this.loadNodeFetchModule()).then(t=>{e(t),r&&clearTimeout(r)}).catch(a=>{"object"==typeof a&&(a.detail=`Execute url '${url}' by method ${o.method} fail.`),this.error.fire(this,a),void 0!==a.processed?e(a.processed):t(a),r&&clearTimeout(r)})})}_ajax(e,t,r){return __awaiter(this,void 0,void 0,function*(){let o,a;if("undefined"==typeof window){let o=yield r();a=o(e,t)}else a=fetch(e,t);return new Promise((e,r)=>{a.then(e=>{let t,r=(o=e).text();return t="string"==typeof r?new Promise((e,t)=>{e(r)}):r}).then(a=>{let n;if((o.headers.get("content-type")||"").indexOf("json")>=0)try{n=a?JSON.parse(a):{}}catch(e){let t=errors_js_1.errors.parseJSONFail(a);console.error(t),n=a}else n=a;if(o.status>=300){let e=new Error;return e.method=t.method,e.name=`${o.status}`,e.message="string"==typeof n?n:n.Message||n.message||"",e.message=e.message||o.statusText,void r(e)}n=this.formatData(n),e(n)}).catch(e=>{console.error(e),r(e)})})})}formatData(e){return formatData(e)}createService(e){let t=new(e=e||Service);return t.error.add((e,r)=>{this.error.fire(t,r)}),t}getByJson(e,t,r){return t&&Object.getOwnPropertyNames(t).length>0&&(e=`${e}?${encodeURIComponent(JSON.stringify(t))}`),(r=r||{})["content-type"]="application/json",this.ajax(e,{headers:r,method:methods.get})}putByJson(e,t,r){return(r=r||{})["content-type"]="application/json",this.ajax(e,{headers:r,data:t,method:methods.put})}postByJson(e,t,r){return(r=r||{})["content-type"]="application/json",this.ajax(e,{headers:r,data:t,method:methods.post})}deleteByJson(e,t,r){return(r=r||{})["content-type"]="application/json",this.ajax(e,{headers:r,data:t,method:methods.delete})}putByFormData(e,t,r){return(r=r||{})["content-type"]="multipart/form-data",this.ajax(e,{headers:r,data:t,method:methods.put})}postByFormData(e,t,r){return(r=r||{})["content-type"]="multipart/form-data",this.ajax(e,{headers:r,data:t,method:methods.post})}deleteByFormData(e,t,r){return(r=r||{})["content-type"]="multipart/form-data",this.ajax(e,{headers:r,data:t,method:methods.delete})}isEncoded(e){try{return(e=e||"")!==decodeURIComponent(e)}catch(e){return!1}}get(e,t,r){t=t||{};let o="";for(let e in t){if(null==t[e])continue;let r=`${t[e]}`;this.isEncoded(r)||(r=encodeURIComponent(r)),o=o?`${o}&${e}=${r}`:`${e}=${r}`}return o&&(e=`${e}?${o}`),this.ajax(e,{headers:r,method:methods.get})}put(e,t,r){return(r=r||{})["content-type"]="application/x-www-form-urlencoded",this.ajax(e,{headers:r,data:t,method:methods.put})}post(e,t,r){return(r=r||{})["content-type"]="application/x-www-form-urlencoded",this.ajax(e,{headers:r,data:t,method:methods.post})}delete(e,t,r){return(r=r||{})["content-type"]="application/x-www-form-urlencoded",this.ajax(e,{headers:r,data:t,method:methods.delete})}}function formatData(e){if("object"==typeof e){for(let t in e)e[t]=formatData(e[t]);return e}return"string"==typeof e&&/^\d{4}-\d{1,2}-\d{1,2}T\d{1,2}:\d{1,2}:\d{1,2}$/.test(e)?new Date(e):e}exports.Service=Service,Service.settings={ajaxTimeout:30},Service.headers={},exports.formatData=formatData},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.errors=t.Errors=void 0;class o{unexpectedNullValue(e){return new Error(`variable ${e} is unexpected null value.`)}parseJSONFail(e){return new Error(`Parse json string fail:\r\n${e}`)}}t.Errors=o,t.errors=new o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CookieValueStore=t.LocalValueStore=t.ValueStore=void 0;class o{constructor(e){this.items=new Array,this._value=e}attach(e,t){return void 0!==this.value&&e(this.value,t),this.add(e,t)}add(e,t){return this.items.push({func:e,sender:t}),e}remove(e){this.items=this.items.filter(t=>t.func!=e)}fire(e){this.items.forEach(t=>t.func(e,t.sender))}get value(){return void 0===this._value?null:this._value}set value(e){this._value=e||void 0,this.fire(e)}}t.ValueStore=o;class a extends o{constructor(e){super(a.loadValue(e)),this.storageName=e}get value(){return super.value}set value(e){super.value=e,a.saveValue(this.storageName,e)}static loadValue(e){let t=localStorage.getItem(e);if(null!=t)return JSON.parse(t)}static saveValue(e,t){null!=t?localStorage.setItem(e,JSON.stringify(t)):localStorage.removeItem(e)}}t.LocalValueStore=a;class n extends o{constructor(e){super(n.loadValue(e)),this.storageName=e}get value(){return super.value}set value(e){super.value=e,n.saveValue(this.storageName,e)}static loadValue(e){let t=n.getCookie(e);if(null!=t)return JSON.parse(t)}static saveValue(e,t){null!=t?n.setCookie(e,JSON.stringify(t)):n.removeCookie(e)}static setCookie(e,t,r){if("undefined"!=typeof document){var o="";if(r){var a=new Date;a.setTime(a.getTime()+24*r*60*60*1e3),o="; expires="+a.toUTCString()}document.cookie=e+"="+(t||"")+o+"; path=/"}}static getCookie(e){if("undefined"==typeof document)return null;for(var t=e+"=",r=document.cookie.split(";"),o=0;o<r.length;o++){for(var a=r[o];" "==a.charAt(0);)a=a.substring(1,a.length);if(0==a.indexOf(t))return a.substring(t.length,a.length)}return null}static removeCookie(e){this.setCookie(e,"")}}t.CookieValueStore=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StatusCode=void 0,function(e){e[e.Login=282]="Login",e[e.Logout=283]="Logout",e[e.NotFound=404]="NotFound",e[e.OK=200]="OK",e[e.Redirect=301]="Redirect",e[e.BadRequest=400]="BadRequest",e[e.Forbidden=403]="Forbidden",e[e.CustomError=700]="CustomError",e[e.ArgumentNull=705]="ArgumentNull",e[e.FieldNull=709]="FieldNull",e[e.ArgumentTypeIncorrect=710]="ArgumentTypeIncorrect",e[e.UserNotLogin=718]="UserNotLogin",e[e.NoPermission=726]="NoPermission",e[e.UserIdNull=727]="UserIdNull",e[e.ObjectNotExistWithId=728]="ObjectNotExistWithId"}(t.StatusCode||(t.StatusCode={}))}])});
//# sourceMappingURL=index.min.js.map